cd ~/svn/Corpora/ga_MU/cmg/CMGCorpusBeag
python ~/svn/Software/Abair/scripts/convertFiles.py htslabel htslab xml/*.xml
cd -

mkdir database/lab
ln -s /media/bigdisk/svn/Corpora/ga_MU/cmg/CMGCorpusBeag/htslab database/lab/label_phone_align
ln -s /media/bigdisk/svn/Corpora/ga_MU/cmg/CMGCorpusBeag/wav16_trimmed database/wav

./01_setup.sh cmg_corpusbeag
#edit conf/global_settings.cfg
#Labels
#QuestionFile


#copy labs, extract feats (part of 02_prepare_labels.sh, 03_prepare_acoustic_features.sh)

./02_prepare_labels_cmg.sh database/wav database/lab

./03_prepare_acoustic_features.sh database/wav database/feats
(Needed to change to b_use_reaper=False in ~/git/hb_merlin/misc/scripts/vocoder/world/extract_features_for_merlin.sh)



if running demo:
make experiments/cmg_corpusbeag/duration_model/data/file_id_list.scp contain just 60 entries!
make experiments/cmg_corpusbeag/acoustic_model/data/file_id_list.scp contain just 60 entries!
else:
change numbers in global_setting.cfg


./04_prepare_conf_files.sh conf/global_settings.cfg

./05_train_duration_model.sh conf/duration_cmg_corpusbeag.cfg
./06_train_duration_model.sh conf/acoustic_cmg_corpusbeag.cfg

Sort of works but the generated wavs in acoustic_model/gen are not right.
What's wrong? Normalisation of label files?
Changed 02_prepare_labels_cmg.sh so that it runs normalisation. Don't see huge difference..
But trying train again..

Otherwise: the first wavfile still seems to contain a lot of silence? And the last label is empty.. And it doesn't begin at 0 with sil..
With convertFiles.py htslabel_data it looks better..
So if not good when this training is run will try again with
Not good so doing this:

cd ~/svn/Corpora/ga_MU/cmg/CMGCorpusBeag
python ~/svn/Software/Abair/scripts/convertFiles.py htslabel_data htslab xml/*.xml
cd -

rm database/lab/full-context-labels/full
ln -s ~/svn/Corpora/ga_MU/cmg/CMGCorpusBeag/htslab database/lab/full-context-labels/full
./02_prepare_labels_cmg.sh database/wav database/lab
#somebody overwrites file_id_list.scp.. Who? When? TODO fix
./05_train_duration_model.sh conf/duration_cmg_corpusbeag.cfg
./06_train_duration_model.sh conf/acoustic_cmg_corpusbeag.cfg

Better but still not as nice as slt-demo, and generated files are cut at the end in a strange way.
What to do?
Trim silence?
Look again at labfiles to make sure they are of the same format?
Everything looks fine to me, I don't see anything strange. Maybe though the "@"? Could that cause a problem with the questions file which uses @ as a delimiter?
Will try to change it in convertFiles.py

Labelfiles not ending with newline? From convertFiles.py? Could this cause the problem?

#HB 180529 Starting again.. labelfiles changed (newline at end, no @'s, x's in first and last line, question file changed), wavfiles changed (no trim at end)
./01_setup.sh cmg_corpusbeag
#edit conf/global_settings.cfg
#Labels
#QuestionFile

./02_prepare_labels_cmg.sh database/wav database/lab
./03_prepare_acoustic_features.sh database/wav database/feats
#Files are not copied to experiments/cmg_corpusbeag/duration_model ? Shouldn't they?

./04_prepare_conf_files.sh conf/global_settings.cfg
#check file_id_list.scp
head -60 database/lab/file_id_list.scp > experiments/cmg_corpusbeag/duration_model/data/file_id_list.scp
./05_train_duration_model.sh conf/duration_cmg_corpusbeag.conf
#Still get the warning, two "labels" missing:
#2018-05-29 14:29:17,736 INFO           dur     : loaded /home/harald/git/hb_merlin/egs/cmg_corpusbeag/s1/experiments/cmg_corpusbeag/duration_model/data/label_phone_align/CI0002CMGCorpusBeag_0051.lab,  50 labels
#2018-05-29 14:29:17,737 WARNING        dur     : len(dur_features) from /home/harald/git/hb_merlin/egs/cmg_corpusbeag/s1/experiments/cmg_corpusbeag/duration_model/gen/feed_forward_6_tanh/CI0002CMGCorpusBeag_0051.dur = 48, len(utt_labels) from /home/harald/git/hb_merlin/egs/cmg_corpusbeag/s1/experiments/cmg_corpusbeag/duration_model/data/label_phone_align/CI0002CMGCorpusBeag_0051.lab = 50
#Is the alignment actually correct?

head -60 database/lab/file_id_list.scp > experiments/cmg_corpusbeag/acoustic_model/data/file_id_list.scp
./06_train_acoustic_model.sh conf/acoustic_cmg_corpusbeag.conf

#redid alignment - but no, still the same error.. 
